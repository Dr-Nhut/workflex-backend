openapi: 3.0.3
info:
  title: Work flex - OpenAPI 3.0
  contact:
    email: lmnhut1612@gmail.com
  version: 1.0.1
servers:
  - url: http://localhost:3000/api
tags:
  - name: category
    description: Everything about your Categories
  - name: skill
    description: Everything about your Skills
  - name: user
    description: Operations about user
paths:
  /auth/register:
    post:
      tags:
        - auth
      summary: Đăng ký tài khoản mới
      description: 'Cho phép người dùng tạo tài khoản nhà tuyển dụng hoặc freelancer'
      operationId: signupUser
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UserInfo'
      responses:
        '200':
          description: Đăng ký thành công
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/SuccessResponse'
                  - type: object
                    properties:
                      metadata:
                        type: object
                        properties:
                          tokens:
                            type: object
                            properties:
                              accessToken:
                                type: string
                                example: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6ImNmZGU4NThiLTk4MmMtNDM3Yy1hY2YyLTI3NGE3NzMwNmEwOSIsImVtYWlsIjoicXV5bGhAZ21haWwuY29tIiwiaWF0IjoxNzI2MDEzMzY4LCJleHAiOjE3MjYxODYxNjh9.hiA5Kpqb3SSCNe770Lh3263xE6CBW2eaLJxZx3wGPDk
                              refreshToken:
                                type: string
                                example: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6ImNmZGU4NThiLTk4MmMtNDM3Yy1hY2YyLTI3NGE3NzMwNmEwOSIsImVtYWlsIjoicXV5bGhAZ21haWwuY29tIiwiaWF0IjoxNzI2MDEzMzY4LCJleHAiOjE3MjYxODYxNjh9.sQelN-zVihKwJvwy3pVyggl5pBAD_KpGmxSgbYT7_EE
                          id:
                            type: string
                            format: uuid
                            example: 5cafca46-7548-44d7-8411-cb21995f79ee
        '400':
          description: BadRequest
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
  /auth/login:
    post:
      tags:
        - auth
      summary: Cho phép user đăng nhập hệ thống
      description: 'Đăng nhập với tài khoản và mật khẩu vào hệ thống'
      operationId: loginUser
      requestBody:
        description: Update an existent user in the store
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AuthLogin'
      responses:
        '200':
          description: Đăng nhập thành công
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/SuccessResponse'
                  - type: object
                    properties:
                      metadata:
                        type: object
                        properties:
                          accessToken:
                            type: string
                            example: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6ImNmZGU4NThiLTk4MmMtNDM3Yy1hY2YyLTI3NGE3NzMwNmEwOSIsImVtYWlsIjoicXV5bGhAZ21haWwuY29tIiwiaWF0IjoxNzI2MDEzMzY4LCJleHAiOjE3MjYxODYxNjh9.hiA5Kpqb3SSCNe770Lh3263xE6CBW2eaLJxZx3wGPDk
                          refreshToken:
                            type: string
                            example: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6ImNmZGU4NThiLTk4MmMtNDM3Yy1hY2YyLTI3NGE3NzMwNmEwOSIsImVtYWlsIjoicXV5bGhAZ21haWwuY29tIiwiaWF0IjoxNzI2MDEzMzY4LCJleHAiOjE3MjYxODYxNjh9.sQelN-zVihKwJvwy3pVyggl5pBAD_KpGmxSgbYT7_EE
        '400':
          description: BadRequest
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
  /auth/logout:
    post:
      tags:
        - auth
      summary: Cho phép user đăng xuất tài khoản
      description: 'Hủy bỏ thông tin đăng nhập của tài khoản trên hệ thống'
      operationId: logoutUser
      responses:
        '200':
          description: Đăng xuất thành công
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'
        '400':
          description: BadRequest
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
  /user/change-avatar:
    patch:
      tags:
        - user
      summary: Cho phép user thay đổi ảnh đại diện
      operationId: changeAvatar
      security:
        - bearerAuth: []
      parameters:
        - in: header
          name: x-client-id
          schema:
            type: string
            format: uuid
          required: true
          description: Client ID for authentication
      requestBody:
        content:
          multipart/form-data:
            schema:
              type: object
              properties:
                avatar:
                  type: string
                  format: binary
      responses:
        '200':
          description: Cập nhật ảnh đại diện thành công!
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/SuccessResponse'
                  - type: object
                    properties:
                      metadata:
                        type: object
                        properties:
                          avatarUrl:
                            type: string
                            example: https://res.cloudinary.com/workflex/image/upload/v1726837084/avatar/cfde858b-982c-437c-acf2-274a77306a09/avatar.jpg
        '400':
          description: BadRequest
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
  /user/update-categories:
    patch:
      tags:
        - user
      summary: Cho phép user cập nhật lĩnh vực chuyên môn
      operationId: updateCategoies
      security:
        - bearerAuth: []
      parameters:
        - in: header
          name: x-client-id
          schema:
            type: string
            format: uuid
          required: true
          description: Client ID for authentication
      requestBody:
        content:
          multipart/form-data:
            schema:
              type: object
              properties:
                categories:
                  type: array
                  example: ['c1008314-6bea-49cf-a8c7-5d095292c692']
      responses:
        '200':
          description: Cập nhật lĩnh vực chuyên môn thành công!
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/SuccessResponse'
                  - type: object
                    properties:
                      metadata:
                        type: array
        '400':
          description: BadRequest
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: NotFounded
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
  /job:
    get:
      tags:
        - job
      summary: Lấy thông tin việc làm đang chào giá trên hệ thống
      description: User
      operationId: getAll
      parameters:
        - name: text
          in: query
          description: Filter by title
          required: false
          explode: true
          schema:
            type: string
        - name: budget
          in: query
          description: minBudget >= budget
          required: false
          explode: true
          schema:
            type: integer
        - name: experience
          in: query
          description: checkbox experience
          required: false
          explode: true
          schema:
            type: array
            items:
              type: string
        - name: categories
          in: query
          description: checkbox category
          required: false
          explode: true
          schema:
            type: array
            items:
              type: string
              format: uuid
        - name: skills
          in: query
          description: checkbox skills
          required: false
          explode: true
          schema:
            type: array
            items:
              type: string
              format: uuid
      responses:
        '200':
          description: Thành công
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/SuccessResponse'
                  - type: object
                    properties:
                      metadata:
                        type: object
                        properties:
                          length:
                            type: integer
                            example: 1
                          jobs:
                            type: array
                            items:
                              type: object
                              $ref: '#/components/schemas/Job'
        '400':
          description: BadRequest
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
    post:
      tags:
        - job
      summary: Thêm mới việc làm
      description: Cho phép nhà tuyển dụng thêm mới việc làm
      security:
        - bearerAuth: []
      operationId: addJob
      parameters:
        - in: header
          name: x-client-id
          schema:
            type: string
            format: uuid
          required: true
          description: Client ID của user thao tác để xác thực
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Job'
      responses:
        '200':
          description: Thêm mới thành công
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/SuccessResponse'
                  - type: object
                    properties:
                      metadata:
                        type: object
                        $ref: '#/components/schemas/Job'

        '400':
          description: BadRequest
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
  /job/{id}:
    patch:
      tags:
        - job
      summary: Cập nhật việc làm ở chế độ draft
      description: Employer
      security:
        - bearerAuth: []
      operationId: updateJob
      parameters:
        - in: header
          name: x-client-id
          schema:
            type: string
            format: uuid
          required: true
          description: Client ID của user thao tác để xác thực
        - in: path
          name: id
          schema:
            type: string
            format: uuid
          required: true
          description: id của công việc
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Job'
      responses:
        '200':
          description: Cập nhật thành công
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/SuccessResponse'
                  - type: object
                    properties:
                      metadata:
                        type: object
                        $ref: '#/components/schemas/Job'

        '400':
          description: BadRequest
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '403':
          description: UnauthorizedError
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
    delete:
      tags:
        - job
      summary: Xóa việc làm chưa ở trạng thái thực hiện
      description: Employer
      security:
        - bearerAuth: []
      operationId: deleteJob
      parameters:
        - in: header
          name: x-client-id
          schema:
            type: string
            format: uuid
          required: true
          description: Client ID của user thao tác để xác thực
        - in: path
          name: id
          schema:
            type: string
            format: uuid
          required: true
          description: id của công việc
      responses:
        '204':
          description: Xóa thành công
        '400':
          description: BadRequest
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '403':
          description: UnauthorizedError
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
  /job/{id}/submit:
    post:
      tags:
        - job
      summary: Gửi công việc cho admin phê duyệt
      description: Employer
      security:
        - bearerAuth: []
      operationId: submitJob
      parameters:
        - in: header
          name: x-client-id
          schema:
            type: string
            format: uuid
          required: true
          description: Client ID của user thao tác để xác thực
        - in: path
          name: id
          schema:
            type: string
            format: uuid
          required: true
          description: id của công việc
      responses:
        '200':
          description: Submit thành công
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'
        '400':
          description: BadRequest
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '403':
          description: UnauthorizedError
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
  /job/{id}/approve:
    post:
      tags:
        - job
      summary: Admin phê duyệt hoặc từ chối công việc
      description: Admin
      security:
        - bearerAuth: []
      operationId: submitJob
      parameters:
        - in: header
          name: x-client-id
          schema:
            type: string
            format: uuid
          required: true
          description: Client ID của user thao tác để xác thực
        - in: path
          name: id
          schema:
            type: string
            format: uuid
          required: true
          description: id của công việc
      requestBody:
        content:
          application/json:
            schema:
              properties:
                result:
                  type: integer
                  example: 1
                reasonRefused:
                  type: string
      responses:
        '200':
          description: Duyệt thành công
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'
        '400':
          description: BadRequest
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '403':
          description: UnauthorizedError
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
  /category:
    get:
      tags:
        - category
      summary: Lấy thông tin tất cả lĩnh vực
      description: Lấy thông tin tất cả các lĩnh vực dành cho Admin
      operationId: getAllCategories
      responses:
        '200':
          description: Thành công
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/SuccessResponse'
                  - type: object
                    properties:
                      metadata:
                        type: object
                        properties:
                          length:
                            type: integer
                            example: 1
                          categories:
                            type: array
                            items:
                              $ref: '#/components/schemas/Category'
        '400':
          description: BadRequest
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
    post:
      tags:
        - category
      summary: Thêm mới lĩnh vực
      description: Thêm mới lĩnh vực vào database
      security:
        - bearerAuth: []
      operationId: addCategory
      parameters:
        - in: header
          name: x-client-id
          schema:
            type: string
            format: uuid
          required: true
          description: Client ID for authentication
      requestBody:
        content:
          application/json:
            schema:
              properties:
                name:
                  type: string
                  example: Quản lý dự án
          application/x-www-form-urlencoded:
            schema:
              properties:
                name:
                  type: string
                  example: Quản lý dự án
        required: true
      responses:
        '200':
          description: Thêm mới thành công
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'
            application/xml:
              schema:
                $ref: '#/components/schemas/SuccessResponse'
        '400':
          description: BadRequest
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
  /category/{id}:
    put:
      tags:
        - category
      summary: Cập nhật lĩnh vực đang tồn tại.
      description: Cập nhật lĩnh vực bằng id
      operationId: updateCategory
      parameters:
        - name: id
          in: path
          description: id của lĩnh vực cần cập nhật
          required: true
          schema:
            type: string
            format: uuid
            default: 2c8ffa97-cfce-4daa-b50c-feff239095fe
      requestBody:
        description: Update an existent cateogry in the store
        content:
          application/json:
            schema:
              properties:
                name:
                  type: string
                  default: Trí tuệ nhân tạo - AI
        required: true
      responses:
        '201':
          description: Cập nhật thành công
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/SuccessResponse'
                  - type: object
                    properties:
                      metadata:
                        $ref: '#/components/schemas/Category'
        '400':
          description: BadRequest
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: NotFound
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
  /permission:
    post:
      tags:
        - permission
      summary: Thêm mới phân quyền
      description: Thêm phân quyền mới vào database
      security:
        - bearerAuth: []
      operationId: addPermission
      parameters:
        - in: header
          name: x-client-id
          schema:
            type: string
            format: uuid
          required: true
          description: Client ID for authentication
      requestBody:
        content:
          application/json:
            schema:
              properties:
                title:
                  type: string
                  example: add-permission
                description:
                  type: string
                  example: Cho phép thêm phân quyền cho hệ thống
        required: true
      responses:
        '201':
          description: Thêm mới thành công
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/SuccessResponse'
                  - type: object
                    properties:
                      metadata:
                        type: object
                        properties:
                          permission:
                            type: object
                            properties:
                              title:
                                type: string
                                example: add-permission
                              description:
                                type: string
                                example: Cho phép thêm phân quyền cho hệ thống
        '400':
          description: BadRequest
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '422':
          description: UnprocessableEntity
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
  /role:
    get:
      tags:
        - role
      summary: Lấy thông tin tất cả vai trò trên hệ thống
      operationId: roleGetAllExceptAdmin
      responses:
        '200':
          description: Thành công!
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/SuccessResponse'
                  - type: object
                    properties:
                      metadata:
                        type: array
                        items:
                          $ref: '#/components/schemas/Role'
        '404':
          description: NotFound
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
  /role/add-permission:
    post:
      tags:
        - role
      summary: Thêm mới quyền cho vai trò
      description: Thêm phân quyền mới cho role trên hệ thống
      security:
        - bearerAuth: []
      operationId: roleAddPermission
      parameters:
        - in: header
          name: x-client-id
          schema:
            type: string
            format: uuid
          required: true
          description: Client ID for authentication
      requestBody:
        content:
          application/json:
            schema:
              properties:
                roleId:
                  type: string
                  format: uuid
                  example: 72d2ce71-b87e-4976-8cb6-b47f2afa5fce
                permissionId:
                  type: string
                  format: uuid
                  example: 9a3d6ee2-945f-4b2a-b85f-eb07f45040be
        required: true
      responses:
        '200':
          description: Thêm quyền cho vai trò thành công!
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/SuccessResponse'
                  - type: object
                    properties:
                      metadata:
                        type: object
                        properties:
                          role:
                            type: object
                            properties:
                              title:
                                type: string
                                example: add-permission
                              description:
                                type: string
                                example: Cho phép thêm phân quyền cho hệ thống
        '400':
          description: BadRequest
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '422':
          description: UnprocessableEntity
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
  /experience:
    get:
      tags:
        - experience
      summary: Lấy thông tin tất cả danh mục kinh nghiệm
      description: All
      operationId: getAllExperiences
      responses:
        '200':
          description: Thành công
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/SuccessResponse'
                  - type: object
                    properties:
                      metadata:
                        type: object
                        properties:
                          length:
                            type: integer
                            example: 1
                          experiences:
                            type: array
                            items:
                              $ref: '#/components/schemas/Experience'
        '404':
          description: NotFound
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
    post:
      tags:
        - experience
      summary: Thêm mới danh mục kinh nghiệm
      description: Admin
      security:
        - bearerAuth: []
      operationId: addExperience
      parameters:
        - in: header
          name: x-client-id
          schema:
            type: string
            format: uuid
          required: true
          description: Client ID for authentication
      requestBody:
        content:
          application/json:
            schema:
              properties:
                name:
                  type: string
                  example: 7 năm
        required: true
      responses:
        '200':
          description: Thêm mới thành công
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'
        '400':
          description: BadRequest
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '403':
          description: UnauthorizedError
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
components:
  schemas:
    UserInfo:
      type: object
      required:
        - email
        - password
        - passwordConfirm
        - name
        - roleId
        - phone
      properties:
        email:
          type: string
          format: email
        name:
          type: string
          example: User
        password:
          type: string
          example: 'nhut@dev'
        passwordConfirm:
          type: string
          example: 'nhut@dev'
        address:
          type: string
          example: 'Quận 1, Thành phố Hồ Chí Minh'
        roleId:
          type: string
          format: uuid
          example: 276f4120-cfc3-4d87-a52c-3988fbc04fe5
        sex:
          type: boolean
        bankAccount:
          type: string
          example: 111122223333
        phone:
          type: string
          example: '0323456789'
        dataOfBirth:
          type: string
          format: date-time
        experience:
          type: string
          example: 'Dưới 1 năm'
        avatar:
          type: string
          example: https://res.cloudinary.com/workflex/image/upload/v1728978220/avatar/32d7d310-dbce-46f3-b15d-f64dba74b04b/avatar.jpg
    AuthLogin:
      type: object
      properties:
        email:
          type: string
          format: email
        password:
          type: string
          example: 'nhut@dev'
    Category:
      type: object
      properties:
        id:
          type: string
          format: uuid
        name:
          type: string
          example: 'Phát triển web'
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time
      xml:
        name: category
    Experience:
      type: object
      properties:
        id:
          type: string
          format: uuid
          example: 2654f526-7526-4294-9923-ea5370d874b4
        name:
          type: string
          example: 'Dưới 1 năm'
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time
      xml:
        name: experience
    Job:
      type: object
      required:
        - title
        - description
        - creatorId
        - minBudget
        - maxBudget
        - dateStart
        - dateEnd
        - bidExpiration
        - categoriyId
      properties:
        title:
          type: string
          example: 'Tạo website để đăng truyện tự sáng tác'
        description:
          type: string
          example: 'Tôi muốn tạo website đăng truyện tự sáng tác. Có chức năng thanh toán trực tuyến'
        categoryId:
          type: string
          format: uuid
          example: '2c8ffa97-cfce-4daa-b50c-feff239095fe'
        skills:
          type: array
          items:
            format: uuid
            example: 28dce3d9-73c0-4736-9909-4d23e52ab5ed
        minBudget:
          type: number
          example: 2000000
        maxBudget:
          type: number
          example: 3000000
        experience:
          type: string
          format: uuid
          example: f28246b1-b3e6-4e1d-af43-cb3286cecb10
        dateStart:
          type: string
          format: date-time
          example: '2024-10-05'
        dateEnd:
          type: string
          format: date-time
          example: '2024-10-10'
        bidExpiration:
          type: string
          format: date-time
          example: '2024-10-01'
        type:
          type: string
          format: ENUM
          example: 'Online'
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time
      xml:
        name: job
    JobSkills:
      type: object
      properties:
        id:
          type: string
          format: uuid
        JobId:
          type: string
          format: uuid
        SkillId:
          type: string
          format: uuid
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time
    Role:
      type: object
      properties:
        id:
          type: string
          format: uuid
        title:
          type: string
          example: freelancer
        description:
          type: string
          example: Ứng viên tìm kiếm việc làm freelance
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time
    SuccessResponse:
      type: object
      properties:
        message:
          type: string
          description: Thông báo về kết quả của operation
        status:
          type: integer
          example: 2xx
          description: Mã trạng thái HTTP
    ErrorResponse:
      type: object
      properties:
        status:
          type: string
          description: Trạng thái của response (thường là "fail")
        message:
          type: string
          description: Thông báo lỗi chi tiết

  # requestBodies:
  securitySchemes:
    api_key:
      type: apiKey
      in: header
      name: x-api-key
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
